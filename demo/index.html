<!doctype html>
<html style="margin: 0; padding: 0; width: 100%; height: 100%">
  <head>
  </head>
  <body style="margin: 0; padding: 0; width: 100%; height: 100%">
    <canvas id="canvas" style="width: 100%; height: 100%"></canvas>

    <script id="fs-source" type="glsl">
      precision highp float;

      varying float vLight;
      varying float vSpec;
      varying float vDist;

      void main() {
        vec3 ambient1 = vec3(0.7, 0.8, 0.9);
        vec3 diffuse1 = vec3(-0.6, -0.3, -0.3);
        vec3 specular1 = vec3(1.0, 1.0, 1.0);
        float k1 = pow(max(0.0, vSpec), 40.0);

        vec3 ambient2 = vec3(0.9, 0.8, 0.7);
        vec3 diffuse2 = vec3(-0.8, -0.7, -0.6);
        vec3 specular2 = vec3(0.1, 0.05, 0.1);
        float k2 = pow(max(0.0, vSpec), 2.0);

        float a = clamp(500.0*(vDist - 0.999), 0.0, 1.0);
        vec3 ambient = (1.0 - a) * ambient1 + a * ambient2;
        vec3 diffuse = (1.0 - a) * diffuse1 + a * diffuse2;
        vec3 specular = (1.0 - a) * specular1 + a * specular2;
        float k = clamp((1.0 - a) * k1 + a * k2, 0.0, 1.0);
        gl_FragColor = vec4(ambient + vLight * diffuse + specular * k, 1.0);
      }
    </script>

    <script id="vs-source" type="glsl">
      attribute vec3 aPosition;
      attribute vec3 aNormal;

      uniform mat4 uModelView;
      uniform mat4 uProjection;

      varying float vLight;
      varying float vSpec;
      varying float vDist;

      void main() {
        vec4 p = uModelView * vec4(aPosition, 1.0);
        vec4 p2 = uModelView * vec4(aPosition, 0.0);
        vec3 lightdir = normalize(vec3(1.0, 0.8, 3.5) - p2.xyz);

        vec3 l = -normalize(vec3(-1.0, 0.5, 3.5) - p2.xyz);
        vec3 n = normalize(uModelView * vec4(aNormal, 0.0)).xyz;
        vec3 r = reflect(l, n);
        vec3 v = normalize(p2.xyz - vec3(0.0, 0.0, -5.0));


        vLight = clamp(dot(-l, n), 0.0, 1.0);
        float k = 40.0;
        vSpec = dot(r, v);
        vDist = length(p2.xyz);

        gl_Position = uProjection * p;
      }
    </script>

    <script src="js/gl-matrix-min.js"></script>
    <script src="js/main.js"></script>
  </body>
</html>
